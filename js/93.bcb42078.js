"use strict";(self["webpackChunkserver_reservation"]=self["webpackChunkserver_reservation"]||[]).push([[93],{116:function(e,s,t){var a=t(6518),r=t(9565),i=t(2652),n=t(9306),l=t(8551),o=t(1767),c=t(9539),d=t(4549),m=d("find",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:m},{find:function(e){l(this);try{n(e)}catch(a){c(this,"throw",a)}if(m)return r(m,this,e);var s=o(this),t=0;return i(s,function(s,a){if(e(s,t++))return a(s)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},7093:function(e,s,t){t.r(s),t.d(s,{default:function(){return os}});var a=t(641),r=t(33),i=t(3751);const n={class:"admin-container"},l={class:"admin-tabs"},o=["onClick"],c=["onClick"],d={key:0,class:"admin-section"},m={class:"admin-panel"},u={class:"form-group"},h={class:"input-with-button"},v=["disabled"],p={class:"form-group"},k=["disabled"],f=["disabled"],g=["disabled"],y={class:"admin-panel"},b={key:0,class:"loading"},L={key:1},C={key:0,class:"empty-state"},w={key:1,class:"members-list"},E={class:"member-info"},U={class:"member-name"},T={class:"member-email"},S={class:"member-actions"},_={key:0,class:"user-type-action"},A=["onUpdate:modelValue","onChange"],I=["onClick"],D={key:1,class:"admin-section"},M={class:"admin-panel"},O={key:0,class:"loading"},X={key:1},R={key:0,class:"empty-state"},P={key:1,class:"items-list"},F={class:"item-info"},N={class:"item-name"},B={class:"item-type"},V={class:"item-actions"},G=["onClick"],$={class:"admin-panel"},z={key:0,class:"loading"},W={key:1},K={key:0,class:"empty-state"},Q={key:1,class:"items-list"},J={class:"item-info"},H={class:"item-name"},x={class:"item-type"},Y={class:"item-actions"},j=["onClick"],Z={key:2,class:"admin-section"},q={class:"admin-panel"},ee={class:"admin-panel"},se={class:"admin-panel"},te={class:"system-info"},ae={class:"info-item"},re={class:"info-value"},ie={class:"info-item"},ne={class:"info-value"},le={class:"info-item"},oe={class:"info-value"},ce={key:3,class:"modal-overlay"},de={class:"modal"},me={class:"modal-content"},ue={class:"form-group"},he=["value"],ve={class:"form-group"},pe={class:"modal-actions"},ke=["disabled"];function fe(e,s,t,fe,ge,ye){const be=(0,a.g2)("router-link"),Le=(0,a.g2)("CacheManager"),Ce=(0,a.g2)("DeltaUpdatesManager");return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(be,{to:"/home",class:"home-icon-button",title:"Home"},{default:(0,a.k6)(()=>[...s[8]||(s[8]=[(0,a.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,a.Lk)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,a.Lk)("polyline",{points:"9 22 9 12 15 12 15 22"})],-1)])]),_:1}),s[33]||(s[33]=(0,a.Lk)("h2",null,"Admin Panel",-1)),(0,a.Lk)("div",l,[(0,a.bF)(be,{to:"/admin/members",custom:""},{default:(0,a.k6)(({navigate:e,isActive:s})=>[(0,a.Lk)("button",{class:(0,r.C4)(["tab-button",{active:"members"===ge.activeTab||s}]),onClick:e}," Group Members ",10,o)]),_:1}),(0,a.bF)(be,{to:"/admin/ownership",custom:""},{default:(0,a.k6)(({navigate:e,isActive:s})=>[(0,a.Lk)("button",{class:(0,r.C4)(["tab-button",{active:"ownership"===ge.activeTab||s}]),onClick:e}," Ownership Transfer ",10,c)]),_:1}),(0,a.Lk)("button",{class:(0,r.C4)(["tab-button",{active:"system"===ge.activeTab}]),onClick:s[0]||(s[0]=e=>ge.activeTab="system")}," System ",2)]),"members"===ge.activeTab?((0,a.uX)(),(0,a.CE)("div",d,[s[15]||(s[15]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",null,"Group Members Management")],-1)),(0,a.Lk)("div",m,[s[12]||(s[12]=(0,a.Lk)("h4",null,"Invite New Member",-1)),(0,a.Lk)("div",u,[s[9]||(s[9]=(0,a.Lk)("label",{for:"inviteEmail"},"Email Address:",-1)),(0,a.Lk)("div",h,[(0,a.bo)((0,a.Lk)("input",{type:"email",id:"inviteEmail","onUpdate:modelValue":s[1]||(s[1]=e=>ge.inviteEmail=e),placeholder:"user@illinois.edu"},null,512),[[i.Jo,ge.inviteEmail]]),(0,a.Lk)("button",{onClick:s[2]||(s[2]=(...e)=>ye.inviteUser&&ye.inviteUser(...e)),class:"action-button",disabled:!ye.isValidEmail||ge.isInviting},(0,r.v_)(ge.isInviting?"Adding...":"Add User"),9,v)])]),(0,a.Lk)("div",p,[s[10]||(s[10]=(0,a.Lk)("label",{for:"userType"},"User Type:",-1)),(0,a.bo)((0,a.Lk)("select",{id:"userType","onUpdate:modelValue":s[3]||(s[3]=e=>ge.newUserType=e),class:"user-type-select"},[(0,a.Lk)("option",{value:"normal",disabled:!ye.canAssignRole("normal")},"Normal User",8,k),(0,a.Lk)("option",{value:"admin",disabled:!ye.canAssignRole("admin")},"Admin",8,f),(0,a.Lk)("option",{value:"guest",disabled:!ye.canAssignRole("guest")},"Guest",8,g)],512),[[i.u1,ge.newUserType]]),s[11]||(s[11]=(0,a.Lk)("p",{class:"help-text"},[(0,a.Lk)("strong",null,"Admin:"),(0,a.eW)(" Can manage members and has full system access."),(0,a.Lk)("br"),(0,a.Lk)("strong",null,"Normal:"),(0,a.eW)(" Regular user with standard permissions."),(0,a.Lk)("br"),(0,a.Lk)("strong",null,"Guest:"),(0,a.eW)(" Limited access user. ")],-1))])]),(0,a.Lk)("div",y,[s[14]||(s[14]=(0,a.Lk)("h4",null,"Manage Members",-1)),ge.isLoading?((0,a.uX)(),(0,a.CE)("div",b," Loading members... ")):((0,a.uX)(),(0,a.CE)("div",L,[0===ge.members.length?((0,a.uX)(),(0,a.CE)("div",C," No members found. ")):((0,a.uX)(),(0,a.CE)("div",w,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ye.sortedMembers,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.email,class:"member-item"},[(0,a.Lk)("div",E,[(0,a.Lk)("div",U,[(0,a.eW)((0,r.v_)(e.name||e.email)+" ",1),(0,a.Lk)("span",{class:(0,r.C4)(["user-type-badge",{"admin-badge":"admin"===e.userType,"normal-badge":"normal"===e.userType,"guest-badge":"guest"===e.userType}])},(0,r.v_)(ye.formatUserType(e.userType)),3)]),(0,a.Lk)("div",T,(0,r.v_)(e.email),1)]),(0,a.Lk)("div",S,[ye.currentUserIsAdmin&&e.email!==ye.currentUserEmail?((0,a.uX)(),(0,a.CE)("div",_,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":s=>e.userType=s,onChange:s=>ye.changeUserType(e),class:"type-select"},[...s[13]||(s[13]=[(0,a.Lk)("option",{value:"admin"},"Admin",-1),(0,a.Lk)("option",{value:"normal"},"Normal",-1),(0,a.Lk)("option",{value:"guest"},"Guest",-1)])],40,A),[[i.u1,e.userType]])])):(0,a.Q3)("",!0),"admin"!==e.userType&&ye.currentUserIsAdmin?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:s=>ye.confirmRemoveMember(e),class:"remove-button"}," Remove ",8,I)):(0,a.Q3)("",!0)])]))),128))]))]))])])):(0,a.Q3)("",!0),"ownership"===ge.activeTab?((0,a.uX)(),(0,a.CE)("div",D,[s[18]||(s[18]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",null,"Ownership Transfer")],-1)),(0,a.Lk)("div",M,[s[16]||(s[16]=(0,a.Lk)("h4",null,"My Servers",-1)),ge.isLoadingServers?((0,a.uX)(),(0,a.CE)("div",O," Loading servers... ")):((0,a.uX)(),(0,a.CE)("div",X,[0===ge.myServers.length?((0,a.uX)(),(0,a.CE)("div",R," You don't own any servers. ")):((0,a.uX)(),(0,a.CE)("div",P,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ge.myServers,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"item"},[(0,a.Lk)("div",F,[(0,a.Lk)("div",N,(0,r.v_)(e.name),1),(0,a.Lk)("div",B,(0,r.v_)(e.cpuType),1)]),(0,a.Lk)("div",V,[(0,a.Lk)("button",{onClick:s=>ye.showTransferModal("server",e),class:"transfer-button"}," Transfer Ownership ",8,G)])]))),128))]))]))]),(0,a.Lk)("div",$,[s[17]||(s[17]=(0,a.Lk)("h4",null,"My Devices",-1)),ge.isLoadingDevices?((0,a.uX)(),(0,a.CE)("div",z," Loading devices... ")):((0,a.uX)(),(0,a.CE)("div",W,[0===ge.myDevices.length?((0,a.uX)(),(0,a.CE)("div",K," You don't own any devices. ")):((0,a.uX)(),(0,a.CE)("div",Q,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ge.myDevices,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"item"},[(0,a.Lk)("div",J,[(0,a.Lk)("div",H,(0,r.v_)(e.name),1),(0,a.Lk)("div",x,(0,r.v_)(e.type),1)]),(0,a.Lk)("div",Y,[(0,a.Lk)("button",{onClick:s=>ye.showTransferModal("device",e),class:"transfer-button"}," Transfer Ownership ",8,j)])]))),128))]))]))])])):(0,a.Q3)("",!0),"system"===ge.activeTab?((0,a.uX)(),(0,a.CE)("div",Z,[s[27]||(s[27]=(0,a.Lk)("div",{class:"section-header"},[(0,a.Lk)("h3",null,"System Management")],-1)),(0,a.Lk)("div",q,[s[19]||(s[19]=(0,a.Lk)("h4",null,"Cache Management",-1)),s[20]||(s[20]=(0,a.Lk)("p",null,"Clear all cached data to force fresh data loading from the server. This includes both local storage and service worker caches.",-1)),(0,a.bF)(Le)]),(0,a.Lk)("div",ee,[s[21]||(s[21]=(0,a.Lk)("h4",null,"Delta Updates",-1)),s[22]||(s[22]=(0,a.Lk)("p",null,"Manage incremental updates for cached data. Delta updates check for changes every 5 minutes to keep data fresh while minimizing Firebase usage.",-1)),(0,a.bF)(Ce)]),(0,a.Lk)("div",se,[s[26]||(s[26]=(0,a.Lk)("h4",null,"System Information",-1)),(0,a.Lk)("div",te,[(0,a.Lk)("div",ae,[s[23]||(s[23]=(0,a.Lk)("span",{class:"info-label"},"Environment:",-1)),(0,a.Lk)("span",re,(0,r.v_)(ye.systemInfo.environment),1)]),(0,a.Lk)("div",ie,[s[24]||(s[24]=(0,a.Lk)("span",{class:"info-label"},"Build Version:",-1)),(0,a.Lk)("span",ne,(0,r.v_)(ye.systemInfo.version),1)]),(0,a.Lk)("div",le,[s[25]||(s[25]=(0,a.Lk)("span",{class:"info-label"},"Service Worker:",-1)),(0,a.Lk)("span",oe,(0,r.v_)(ye.systemInfo.serviceWorker),1)])])])])):(0,a.Q3)("",!0),ge.showTransfer?((0,a.uX)(),(0,a.CE)("div",ce,[(0,a.Lk)("div",de,[s[32]||(s[32]=(0,a.Lk)("div",{class:"modal-header"},[(0,a.Lk)("h4",null,"Transfer Ownership")],-1)),(0,a.Lk)("div",me,[(0,a.Lk)("p",null,[s[28]||(s[28]=(0,a.eW)(" You are transferring ownership of ",-1)),(0,a.Lk)("strong",null,(0,r.v_)(ge.transferItem.name),1),(0,a.eW)(" ("+(0,r.v_)("server"===ge.transferItemType?"Server":"Device")+"). ",1)]),(0,a.Lk)("div",ue,[s[30]||(s[30]=(0,a.Lk)("label",{for:"newOwner"},"New Owner:",-1)),(0,a.bo)((0,a.Lk)("select",{id:"newOwner","onUpdate:modelValue":s[4]||(s[4]=e=>ge.newOwner=e),required:""},[s[29]||(s[29]=(0,a.Lk)("option",{value:"",disabled:""},"Select a member",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ye.memberOptions,e=>((0,a.uX)(),(0,a.CE)("option",{key:e.email,value:e.email},(0,r.v_)(e.name||e.email),9,he))),128))],512),[[i.u1,ge.newOwner]])]),(0,a.Lk)("div",ve,[s[31]||(s[31]=(0,a.Lk)("label",{for:"transferComment"},"Comment (optional):",-1)),(0,a.bo)((0,a.Lk)("textarea",{id:"transferComment","onUpdate:modelValue":s[5]||(s[5]=e=>ge.transferComment=e),placeholder:"Add a note about this transfer",rows:"3"},null,512),[[i.Jo,ge.transferComment]])])]),(0,a.Lk)("div",pe,[(0,a.Lk)("button",{onClick:s[6]||(s[6]=(...e)=>ye.confirmTransfer&&ye.confirmTransfer(...e)),class:"confirm-button",disabled:!ge.newOwner}," Transfer Ownership ",8,ke),(0,a.Lk)("button",{onClick:s[7]||(s[7]=(...e)=>ye.cancelTransfer&&ye.cancelTransfer(...e)),class:"cancel-button"},"Cancel")])])])):(0,a.Q3)("",!0)])}t(8111),t(2489),t(116),t(1701),t(3579);var ge=t(1560),ye=t(1884),be=t(9986);const Le={class:"cache-manager"},Ce=["disabled"],we={key:0,class:"cache-status"};function Ee(e,s,t,i,n,l){return(0,a.uX)(),(0,a.CE)("div",Le,[(0,a.Lk)("button",{onClick:s[0]||(s[0]=(...e)=>l.clearAllCaches&&l.clearAllCaches(...e)),class:"clear-cache-btn",disabled:n.isClearing,title:"Clear all cached data and refresh from server"},(0,r.v_)(n.isClearing?"Clearing...":"Clear Cache"),9,Ce),n.showStatus?((0,a.uX)(),(0,a.CE)("div",we,[(0,a.Lk)("p",null,(0,r.v_)(n.statusMessage),1)])):(0,a.Q3)("",!0)])}var Ue=t(3290),Te={name:"CacheManager",data(){return{isClearing:!1,showStatus:!1,statusMessage:""}},methods:{async clearAllCaches(){this.isClearing=!0,this.showStatus=!0;try{this.statusMessage="Clearing localStorage cache...",be._.clearAllCache(),this.statusMessage="Clearing service worker cache...",await Ue.D.clearAllCaches(),this.statusMessage="Cache cleared successfully! Refreshing page...",setTimeout(()=>{window.location.reload()},1e3)}catch(e){console.error("Error clearing caches:",e),this.statusMessage="Error clearing cache. Please refresh manually.",setTimeout(()=>{this.showStatus=!1},3e3)}this.isClearing=!1}}},Se=t(6262);const _e=(0,Se.A)(Te,[["render",Ee],["__scopeId","data-v-5366338d"]]);var Ae=_e;const Ie={class:"delta-manager"},De={class:"delta-controls"},Me=["disabled"],Oe=["disabled"],Xe={class:"delta-status"},Re={class:"status-header"},Pe={class:"status-summary"},Fe={class:"status-item"},Ne={class:"value"},Be={key:0,class:"listeners-list"},Ve={class:"listener-info"},Ge={class:"data-type"},$e={class:"collection"},ze={class:"listener-meta"},We={class:"meta-item"},Ke={class:"meta-value"},Qe={key:0,class:"meta-item"},Je={class:"meta-value"},He=["onClick","disabled"],xe={key:1,class:"no-listeners"},Ye={key:0,class:"recent-updates"},je={class:"updates-list"},Ze={class:"update-type"},qe={class:"update-count"},es={class:"update-time"};function ss(e,s,t,i,n,l){return(0,a.uX)(),(0,a.CE)("div",Ie,[(0,a.Lk)("div",De,[(0,a.Lk)("button",{onClick:s[0]||(s[0]=(...e)=>l.toggleDeltaUpdates&&l.toggleDeltaUpdates(...e)),class:(0,r.C4)(["toggle-btn",n.deltaStatus.activeListeners>0?"active":"inactive"]),disabled:!n.deltaStatus.isOnline},(0,r.v_)(n.deltaStatus.activeListeners>0?"Stop":"Start")+" Delta Updates ",11,Me),(0,a.Lk)("button",{onClick:s[1]||(s[1]=(...e)=>l.forceCheckAll&&l.forceCheckAll(...e)),class:"check-btn",disabled:!n.deltaStatus.isOnline||n.isChecking},(0,r.v_)(n.isChecking?"Checking...":"Check Now"),9,Oe)]),(0,a.Lk)("div",Xe,[(0,a.Lk)("div",Re,[s[2]||(s[2]=(0,a.Lk)("h5",null,"Delta Updates Status",-1)),(0,a.Lk)("span",{class:(0,r.C4)(["status-indicator",n.deltaStatus.isOnline?"online":"offline"])},(0,r.v_)(n.deltaStatus.isOnline?"ðŸŸ¢ Online":"ðŸ”´ Offline"),3)]),(0,a.Lk)("div",Pe,[(0,a.Lk)("div",Fe,[s[3]||(s[3]=(0,a.Lk)("span",{class:"label"},"Active Listeners:",-1)),(0,a.Lk)("span",Ne,(0,r.v_)(n.deltaStatus.activeListeners),1)])]),Object.keys(n.deltaStatus.listeners).length>0?((0,a.uX)(),(0,a.CE)("div",Be,[s[6]||(s[6]=(0,a.Lk)("h6",null,"Active Data Types:",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.deltaStatus.listeners,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"listener-item"},[(0,a.Lk)("div",Ve,[(0,a.Lk)("span",Ge,(0,r.v_)(l.formatDataType(t)),1),(0,a.Lk)("span",$e,(0,r.v_)(e.collectionName),1)]),(0,a.Lk)("div",ze,[(0,a.Lk)("div",We,[s[4]||(s[4]=(0,a.Lk)("span",{class:"meta-label"},"Last Check:",-1)),(0,a.Lk)("span",Ke,(0,r.v_)(l.formatTime(e.lastCheck)),1)]),e.lastUpdate?((0,a.uX)(),(0,a.CE)("div",Qe,[s[5]||(s[5]=(0,a.Lk)("span",{class:"meta-label"},"Last Update:",-1)),(0,a.Lk)("span",Je,(0,r.v_)(l.formatTime(e.lastUpdate)),1)])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:e=>l.forceCheckSingle(t),class:"force-check-btn",disabled:!n.deltaStatus.isOnline}," Check ",8,He)])]))),128))])):((0,a.uX)(),(0,a.CE)("div",xe,[...s[7]||(s[7]=[(0,a.Lk)("p",null,"No delta updates are currently active.",-1),(0,a.Lk)("p",{class:"help-text"}," Delta updates automatically check for changes to cached data every 5 minutes, reducing Firebase usage while keeping data fresh. ",-1)])]))]),n.recentUpdates.length>0?((0,a.uX)(),(0,a.CE)("div",Ye,[s[8]||(s[8]=(0,a.Lk)("h6",null,"Recent Updates:",-1)),(0,a.Lk)("div",je,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.recentUpdates,(e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:"update-item"},[(0,a.Lk)("span",Ze,(0,r.v_)(l.formatDataType(e.dataType)),1),(0,a.Lk)("span",qe,(0,r.v_)(e.count)+" items",1),(0,a.Lk)("span",es,(0,r.v_)(l.formatTime(e.timestamp)),1)]))),128))])])):(0,a.Q3)("",!0)])}var ts=t(2907),as={name:"DeltaUpdatesManager",data(){return{deltaStatus:{isOnline:navigator.onLine,activeListeners:0,listeners:{}},recentUpdates:[],isChecking:!1,statusInterval:null}},mounted(){this.updateStatus(),this.statusInterval=setInterval(()=>{this.updateStatus()},1e4),window.addEventListener("deltaUpdate",this.handleDeltaUpdate)},beforeUnmount(){this.statusInterval&&clearInterval(this.statusInterval),window.removeEventListener("deltaUpdate",this.handleDeltaUpdate)},methods:{updateStatus(){this.deltaStatus=ts.B.getStatus()},toggleDeltaUpdates(){if(this.deltaStatus.activeListeners>0)ts.B.stopAllUpdates();else{const e=["servers","devices","users","announcements"];e.forEach(e=>{const s="users"===e?"authorizedUsers":e;ts.B.startDeltaUpdates(e,{collectionName:s,batchSize:20,updateInterval:3e5})})}setTimeout(()=>this.updateStatus(),100)},async forceCheckAll(){if(this.deltaStatus.isOnline){this.isChecking=!0;try{await ts.B.checkAllPendingUpdates()}catch(e){console.error("Error force checking all updates:",e)}this.isChecking=!1,this.updateStatus()}},async forceCheckSingle(e){if(this.deltaStatus.isOnline){try{await ts.B.forceCheck(e)}catch(s){console.error(`Error force checking ${e}:`,s)}this.updateStatus()}},handleDeltaUpdate(e){const{dataType:s,updates:t,timestamp:a}=e.detail;this.recentUpdates.unshift({dataType:s,count:t.length,timestamp:new Date(a)}),this.recentUpdates.length>10&&(this.recentUpdates=this.recentUpdates.slice(0,10))},formatDataType(e){const s={servers:"Servers",devices:"Devices",users:"Users",announcements:"Announcements"};return s[e]||e},formatTime(e){if(!e)return"Never";const s=e instanceof Date?e:new Date(e),t=Date.now(),a=t-s.getTime();return a<6e4?"Just now":a<36e5?`${Math.floor(a/6e4)}m ago`:a<864e5?`${Math.floor(a/36e5)}h ago`:s.toLocaleDateString()}}};const rs=(0,Se.A)(as,[["render",ss],["__scopeId","data-v-41ce10b9"]]);var is=rs,ns={name:"AdminView",components:{CacheManager:Ae,DeltaUpdatesManager:is},props:{defaultTab:String},data(){return{activeTab:"members",members:[],myServers:[],myDevices:[],isLoading:!0,isLoadingServers:!0,isLoadingDevices:!0,inviteEmail:"",isInviting:!1,showTransfer:!1,transferItemType:null,transferItem:null,newOwner:"",transferComment:"",isTransferring:!1,newUserType:"normal"}},computed:{currentUserEmail(){return ge.j2.currentUser?ge.j2.currentUser.email:""},currentUsername(){return this.currentUserEmail?this.currentUserEmail.split("@")[0]:""},currentUser(){return this.members.find(e=>e.email===this.currentUserEmail)||null},currentUserIsAdmin(){return"minho7571@gmail.com"===this.currentUserEmail||!!this.currentUser&&"admin"===this.currentUser.userType},isValidEmail(){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(this.inviteEmail)&&this.inviteEmail!==this.currentUserEmail},memberOptions(){return this.members.filter(e=>e.email!==this.currentUserEmail)},sortedMembers(){return[...this.members].sort((e,s)=>{const t={admin:1,normal:2,guest:3},a=t[e.userType]||2,r=t[s.userType]||2;if(a!==r)return a-r;const i=e.name||e.email||"",n=s.name||s.email||"";return i.localeCompare(n)})},currentUserRoleLevel(){const e={admin:3,normal:2,guest:1};if("minho7571@gmail.com"===this.currentUserEmail)return e.admin;const s=this.members.find(e=>e.email===this.currentUserEmail);return s&&s.userType&&e[s.userType]||e.normal},systemInfo(){return{environment:"production",version:{NODE_ENV:"production",VUE_APP_FIREBASE_API_KEY:"AIzaSyAL4I77pNWQwObbxsvF0LKvt-EJB0DWRgo",VUE_APP_FIREBASE_AUTH_DOMAIN:"caslab-server-reservation.firebaseapp.com",VUE_APP_FIREBASE_PROJECT_ID:"caslab-server-reservation",VUE_APP_FIREBASE_STORAGE_BUCKET:"caslab-server-reservation.firebasestorage.app",VUE_APP_FIREBASE_MESSAGING_SENDER_ID:"1042418034132",VUE_APP_FIREBASE_APP_ID:"1:1042418034132:web:c37b0d2217499a1514e241",VUE_APP_FIREBASE_MEASUREMENT_ID:"G-C0SWSK5QKC",BASE_URL:"/"}.VUE_APP_VERSION||"1.0.0",serviceWorker:"serviceWorker"in navigator?"Available":"Not Available"}}},methods:{async inviteUser(){if(this.isValidEmail&&!this.isInviting)if(this.currentUserRoleLevel<=1)alert("Guest users cannot invite new members.");else{this.isInviting=!0;try{const e=this.members.some(e=>e.email.toLowerCase()===this.inviteEmail.toLowerCase());if(e)return alert("This user is already a member."),void(this.isInviting=!1);if(!this.canAssignRole(this.newUserType))return alert(`You don't have permission to create a user with ${this.formatUserType(this.newUserType)} privileges.`),void(this.isInviting=!1);await(0,ye.gS)((0,ye.rJ)(ge.kA,"authorizedUsers"),{email:this.inviteEmail,addedBy:this.currentUserEmail,addedDate:(new Date).toISOString(),userType:this.newUserType}),await this.refreshMemberCache();const s="https://skyp0714.github.io/ServerReservation/";alert(`User ${this.inviteEmail} added. Share this link with them: ${s}`),this.inviteEmail="",this.newUserType="normal"}catch(e){console.error("Error inviting user:",e),alert("Failed to add user. Please try again.")}finally{this.isInviting=!1}}},confirmRemoveMember(e){confirm(`Are you sure you want to remove ${e.email} from the system?`)&&this.removeMember(e)},async removeMember(e){try{const s=(0,ye.rJ)(ge.kA,"authorizedUsers"),t=(0,ye.P)(s,(0,ye._M)("email","==",e.email)),a=await(0,ye.GG)(t);if(a.empty)return void alert("User not found.");await(0,ye.kd)((0,ye.H9)(ge.kA,"authorizedUsers",a.docs[0].id)),await this.refreshMemberCache(),alert(`${e.email} has been removed from the system.`)}catch(s){console.error("Error removing member:",s),alert("Failed to remove member. Please try again.")}},showTransferModal(e,s){this.transferItemType=e,this.transferItem=s,this.newOwner="",this.transferComment="",this.showTransfer=!0},cancelTransfer(){this.showTransfer=!1,this.transferItemType=null,this.transferItem=null},async confirmTransfer(){if(this.newOwner&&!this.isTransferring){this.isTransferring=!0;try{if("server"===this.transferItemType){const e=(0,ye.H9)(ge.kA,"servers",this.transferItem.id);await(0,ye.mZ)(e,{owner:this.newOwner.split("@")[0],transferredBy:this.currentUserEmail,transferDate:(new Date).toISOString(),transferComment:this.transferComment||""})}else if("device"===this.transferItemType){const e=(0,ye.H9)(ge.kA,"devices",this.transferItem.id);await(0,ye.mZ)(e,{owner:this.newOwner.split("@")[0],transferredBy:this.currentUserEmail,transferDate:(new Date).toISOString(),transferComment:this.transferComment||""})}alert(`Ownership of ${this.transferItem.name} has been transferred to ${this.newOwner}.`),this.showTransfer=!1}catch(e){console.error("Error transferring ownership:",e),alert("Failed to transfer ownership. Please try again.")}finally{this.isTransferring=!1}}},formatUserType(e){const s={admin:"Admin",guest:"Guest",normal:"Normal"};return s[e]||"Normal"},async changeUserType(e){try{if(!e||!e.id)return void console.error("Cannot update member: missing ID");if("minho7571@gmail.com"===e.email)return void alert("Cannot change the type for the default admin user.");const s=(0,ye.H9)(ge.kA,"authorizedUsers",e.id);await(0,ye.mZ)(s,{userType:e.userType,updatedBy:this.currentUserEmail,updatedDate:(new Date).toISOString()}),console.log(`User type updated for ${e.email} to ${e.userType}`),await this.refreshMemberCache()}catch(s){console.error("Error updating user type:",s),alert("Failed to update user type. Please try again.")}},canAssignRole(e){const s={admin:3,normal:2,guest:1};return s[e]<=this.currentUserRoleLevel},async loadMembers(){try{const e=await be._.loadData("users","authorizedUsers");this.members=e.map(e=>({...e,userType:e.userType||(e.isAdmin?"admin":"normal")})),this.isLoading=!1,console.log("Loaded members:",this.members.length)}catch(e){console.error("Error loading members:",e),this.isLoading=!1,this.members=[]}},async loadMyServers(){try{const e=await be._.loadData("servers");this.myServers=e.filter(e=>e.owner===this.currentUsername),this.isLoadingServers=!1,console.log("Loaded my servers:",this.myServers.length)}catch(e){console.error("Error loading servers:",e),this.isLoadingServers=!1,this.myServers=[]}},async loadMyDevices(){try{const e=await be._.loadData("devices");this.myDevices=e.filter(e=>e.owner===this.currentUsername),this.isLoadingDevices=!1,console.log("Loaded my devices:",this.myDevices.length)}catch(e){console.error("Error loading devices:",e),this.isLoadingDevices=!1,this.myDevices=[]}},async initAuthorizedUsers(){const e=(0,ye.rJ)(ge.kA,"authorizedUsers"),s=await(0,ye.GG)(e);if(s.empty)try{await(0,ye.gS)(e,{email:"minho7571@gmail.com",name:"Admin User",userType:"admin",addedDate:(new Date).toISOString()}),console.log("Default admin user added")}catch(t){console.error("Error adding default admin user:",t)}},async refreshMemberCache(){try{const e=await be._.refreshData("users","authorizedUsers");this.members=e.map(e=>({...e,userType:e.userType||(e.isAdmin?"admin":"normal")})),console.log("Cache refreshed - Members:",this.members.length)}catch(e){console.error("Error refreshing member cache:",e)}}},mounted(){this.initAuthorizedUsers().then(()=>{this.loadMembers(),this.loadMyServers(),this.loadMyDevices()});const e=this.$route.path;e.includes("/members")?this.activeTab="members":e.includes("/ownership")?this.activeTab="ownership":this.defaultTab&&(this.activeTab=this.defaultTab)},watch:{$route(e){e.path.includes("/members")?this.activeTab="members":e.path.includes("/ownership")&&(this.activeTab="ownership")}}};const ls=(0,Se.A)(ns,[["render",fe],["__scopeId","data-v-fa009a8c"]]);var os=ls}}]);
//# sourceMappingURL=93.bcb42078.js.map